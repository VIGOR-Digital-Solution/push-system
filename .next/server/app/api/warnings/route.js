"use strict";(()=>{var e={};e.id=719,e.ids=[719],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5900:e=>{e.exports=require("pg")},8018:e=>{e.exports=require("puppeteer")},9983:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>w,originalPathname:()=>b,patchFetch:()=>v,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>y});var a={};r.r(a),r.d(a,{GET:()=>p,POST:()=>c});var n=r(5419),s=r(9108),i=r(9678),o=r(8018),u=r.n(o),l=r(9247),d=r(7037);async function p(){try{let e=await u().launch({headless:"shell"}),t=await e.newPage();await t.goto("http://10.128.20.11/cgsreports/factoryMonitor/LineStatusReport.do?nodeKey=7&lineKey=null&toolKey=null&fbLocation=null");let r=await t.evaluate(async()=>{let e=document.querySelector("table.reportElement#table912Report"),t=e?.querySelectorAll("tbody>tr"),r=Array.from(t).splice(5);return Array.from(r).map(e=>{let t=e.querySelectorAll("td"),r=t[7].innerText,a=r.match(/part number ([^,]+)/),n=r.match(/component ([^,]+)/),s="",i="";a&&a.length>1&&(s=a[1]),n&&n.length>1&&(i=n[1]);let o=t[0].innerText.trim(),u=t[1].innerText.trim(),l=t[6].innerText.trim(),d=t[3].innerText.trim(),p=t[4].innerText.trim();return{ref:o+"_"+s+"_"+i+"_"+u+"_"+l,lineName:o,partNo:s,materialId:i,machineId:u,status:"",location:l,remainingTime:d,remainingBoards:p,remainingSeconds:null}})});await e.close();let a=await l.db.select().from(d.Xd),n=a.find(e=>"time_low_threshold"===e.refTitle)?.value,s=a.find(e=>"panel_low_threshold"===e.refTitle)?.value,i=a.find(e=>"panel_exhaust_threshold"===e.refTitle)?.value,o=await l.db.select({ref:d.qB.ref,status:d.qB.status}).from(d.qB),p=r.map(e=>{let t=e.remainingTime,r=e.remainingBoards,a="";(t.includes("-")?0:1)&&(Number(r)===Number(i)?0:1)?((e=>{let t=e.split(":").map(Number),r=t[0],a=t[1],n=t[2];return 3600*r+60*a+n})(t)<Number(n)||Number(r)<Number(s))&&(a="low"):a="exhaust";let u=o.find(t=>t.ref===e.ref);return u?{...e,status:u.status}:{...e,status:a}});return Response.json(p,{status:200})}catch(e){return Response.json({message:e.message},{status:400})}}async function c(e){try{let t=await e.json(),r=t?.refs;if(!r)throw Error("Refs not found");let a=r.map(e=>({ref:e,pickStatus:"picked"}));return await l.db.insert(d.qB).values(a),Response.json("ok",{status:200})}catch(e){return Response.json({message:e.message},{status:400})}}let m=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/warnings/route",pathname:"/api/warnings",filename:"route",bundlePath:"app/api/warnings/route"},resolvedPagePath:"C:\\Users\\UserAdmin\\Documents\\GitHub\\nation-gate-frontend\\src\\app\\api\\warnings\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:h,headerHooks:w,staticGenerationBailout:y}=m,b="/api/warnings/route";function v(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},9247:(e,t,r)=>{r.d(t,{db:()=>s});var a=r(8363);let n=new(r(5900)).Pool({connectionString:process.env.POSTGRES_URL}),s=(0,a.t)(n)},7037:(e,t,r)=>{r.d(t,{Xd:()=>p,qB:()=>d});var a=r(4330),n=r(6155),s=r(9703),i=r(6664),o=r(7362),u=r(5630);let l=(0,a.ys)("status",["printed","picked"]),d=(0,n.af)("warnings",{id:(0,s.Vj)("id").defaultRandom().primaryKey(),ref:(0,i.fL)("ref").unique(),status:l("status"),createdAt:(0,o.AB)("created_at",{mode:"date"}).defaultNow()}),p=(0,n.af)("settings",{id:(0,s.Vj)("id").defaultRandom().primaryKey(),refTitle:(0,i.fL)("ref_title").unique(),title:(0,i.fL)("title"),description:(0,i.fL)("description"),value:(0,u.uR)("value"),createdAt:(0,o.AB)("created_at",{mode:"date"}).defaultNow()})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,547],()=>r(9983));module.exports=a})();
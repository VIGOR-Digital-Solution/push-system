"use strict";(()=>{var e={};e.id=577,e.ids=[577],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8018:e=>{e.exports=require("puppeteer")},1067:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>g,originalPathname:()=>y,patchFetch:()=>b,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>w});var r={};a.r(r),a.d(r,{GET:()=>c,POST:()=>p});var n=a(5419),s=a(9108),i=a(9678),l=a(8018),o=a.n(l),u=a(4075);async function c(){let e;try{e=await o().launch({headless:"shell",args:["--aggressive-cache-discard","--disable-cache","--disable-application-cache","--disable-offline-load-stale-cache","--disable-gpu-shader-disk-cache","--media-cache-size=0","--disk-cache-size=0"]});let t=await e.newPage();await t.goto("http://10.128.20.11/cgsreports/factoryMonitor/LineStatusReport.do?nodeKey=7&lineKey=null&toolKey=null&fbLocation=null");let a=await t.evaluate(async()=>{let e=document.querySelector("table.reportElement#table912Report");if(!e)return[];let t=e?.querySelectorAll("tbody>tr"),a=Array.from(t).splice(5);return Array.from(a).map(e=>{let t=e.querySelectorAll("td"),a=t[7].innerText,r=a.match(/part number ([^,]+)/),n=a.match(/component ([^,]+)/),s="",i="";r&&r.length>1&&(s=r[1]),n&&n.length>1&&(i=n[1]);let l=t[0].innerText.trim(),o=t[1].innerText.trim(),u=t[6].innerText.trim(),c=t[3].innerText.trim(),p=t[4].innerText.trim();return{ref:l+"_"+s+"_"+i+"_"+o+"_"+u,lineName:l,partNo:s,materialId:i,machineId:o,status:"",location:u,remainingTime:c,remainingBoards:p,remainingSeconds:null,currentQuantity:""}})}),r=await u.Z.setting.findMany({select:{refTitle:!0,value:!0}}),n=r.find(e=>"time_low_threshold"===e.refTitle)?.value,s=r.find(e=>"panel_low_threshold"===e.refTitle)?.value,i=r.find(e=>"panel_exhaust_threshold"===e.refTitle)?.value,l=await u.Z.warning.findMany({select:{ref:!0,status:!0}}),c=a.map(e=>{let t=e.remainingTime,a=e.remainingBoards,r="";(t.includes("-")?0:1)&&(Number(a)===Number(i)?0:1)?((e=>{let t=e.split(":").map(Number),a=t[0],r=t[1],n=t[2];return 3600*a+60*r+n})(t)<Number(n)||Number(a)<Number(s))&&(r="low"):r="exhaust";let o=l.find(t=>t.ref===e.ref);return o?{...e,status:o.status}:{...e,status:r}});return Response.json(c,{status:200})}catch(e){return Response.json({message:e.message},{status:500})}finally{let t=await e?.pages()||[];for(let e=0;e<t.length;e++)await t[e].close();await e?.close()}}async function p(e){try{let t=await e.json(),a=t?.refs;if(!a)throw Error("Refs not found");let r=a.map(e=>({ref:e,pickStatus:"picked"}));return await u.Z.warning.create({data:r}),Response.json("ok",{status:200})}catch(e){return Response.json({message:e.message},{status:400})}}let d=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/prisma/warnings/route",pathname:"/api/prisma/warnings",filename:"route",bundlePath:"app/api/prisma/warnings/route"},resolvedPagePath:"C:\\Users\\UserAdmin\\Documents\\GitHub\\nation-gate-frontend\\src\\app\\api\\prisma\\warnings\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:f,headerHooks:g,staticGenerationBailout:w}=d,y="/api/prisma/warnings/route";function b(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:h})}},5419:(e,t,a)=>{e.exports=a(517)},4075:(e,t,a)=>{a.d(t,{Z:()=>n});let r=require("@prisma/client"),n=globalThis.prismaGlobal??new r.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[638],()=>a(1067));module.exports=r})();
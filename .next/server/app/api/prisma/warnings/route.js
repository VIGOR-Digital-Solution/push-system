"use strict";(()=>{var e={};e.id=577,e.ids=[577],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8018:e=>{e.exports=require("puppeteer")},1067:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>g,originalPathname:()=>y,patchFetch:()=>b,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>w});var a={};r.r(a),r.d(a,{GET:()=>p,POST:()=>m});var n=r(5419),s=r(9108),i=r(9678),o=r(8018),l=r.n(o),u=r(4075);async function p(){try{let e=await l().launch({headless:"shell"}),t=await e.newPage();await t.goto("http://10.128.20.11/cgsreports/factoryMonitor/LineStatusReport.do?nodeKey=7&lineKey=null&toolKey=null&fbLocation=null");let r=await t.evaluate(async()=>{let e=document.querySelector("table.reportElement#table912Report"),t=e?.querySelectorAll("tbody>tr"),r=Array.from(t).splice(5);return Array.from(r).map(e=>{let t=e.querySelectorAll("td"),r=t[7].innerText,a=r.match(/part number ([^,]+)/),n=r.match(/component ([^,]+)/),s="",i="";a&&a.length>1&&(s=a[1]),n&&n.length>1&&(i=n[1]);let o=t[0].innerText.trim(),l=t[1].innerText.trim(),u=t[6].innerText.trim(),p=t[3].innerText.trim(),m=t[4].innerText.trim();return{ref:o+"_"+s+"_"+i+"_"+l+"_"+u,lineName:o,partNo:s,materialId:i,machineId:l,status:"",location:u,remainingTime:p,remainingBoards:m,remainingSeconds:null}})});await e.close();let a=await u.Z.setting.findMany({select:{refTitle:!0,value:!0}}),n=a.find(e=>"time_low_threshold"===e.refTitle)?.value,s=a.find(e=>"panel_low_threshold"===e.refTitle)?.value,i=a.find(e=>"panel_exhaust_threshold"===e.refTitle)?.value,o=await u.Z.warning.findMany({select:{ref:!0,status:!0}}),p=r.map(e=>{let t=e.remainingTime,r=e.remainingBoards,a="";(t.includes("-")?0:1)&&(Number(r)===Number(i)?0:1)?((e=>{let t=e.split(":").map(Number),r=t[0],a=t[1],n=t[2];return 3600*r+60*a+n})(t)<Number(n)||Number(r)<Number(s))&&(a="low"):a="exhaust";let l=o.find(t=>t.ref===e.ref);return l?{...e,status:l.status}:{...e,status:a}});return Response.json(p,{status:200})}catch(e){return Response.json({message:e.message},{status:400})}}async function m(e){try{let t=await e.json(),r=t?.refs;if(!r)throw Error("Refs not found");let a=r.map(e=>({ref:e,pickStatus:"picked"}));return await u.Z.warning.create({data:a}),Response.json("ok",{status:200})}catch(e){return Response.json({message:e.message},{status:400})}}let c=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/prisma/warnings/route",pathname:"/api/prisma/warnings",filename:"route",bundlePath:"app/api/prisma/warnings/route"},resolvedPagePath:"C:\\Users\\UserAdmin\\Documents\\GitHub\\nation-gate-frontend\\src\\app\\api\\prisma\\warnings\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:f,serverHooks:h,headerHooks:g,staticGenerationBailout:w}=c,y="/api/prisma/warnings/route";function b(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},5419:(e,t,r)=>{e.exports=r(517)},4075:(e,t,r)=>{r.d(t,{Z:()=>n});let a=require("@prisma/client"),n=globalThis.prismaGlobal??new a.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638],()=>r(1067));module.exports=a})();